const simpleDirectives={};(function(e){function t(e){return{in:t=>-1!==t.indexOf(e),oneOf:t=>t.some(t=>t===e)}}function s(e){let t;for(;-1!==(t=e.indexOf(null));)e.splice(t,1)}function i(e){const t=e.split(":"),s=t.shift(),i=t.join(":");return[s,i]}class r{constructor(e,t){this.elements=[],this.pointers=[],this.root=t||window,this.register(e||document.body),this.runner()}register(e,i){const r=Object.keys(x).map(e=>e.replace("d","d-").toLowerCase());let c,a=!1;if(e.hasAttributes()){let h=Array.from(e.attributes).map(({name:s,value:i})=>{const n="sd-rdo"!==s||d.isFirstRdoOfGroup(this,e);return t(s).in(r)&&n?(t(s).in(["sd-if","sd-for"])&&(a=!0),{type:s,value:i.replace(/\s+/g,"")}):null});s(h),h.length&&(c=new n(this,e,h,Object.assign({},i||{})),this.elements.push(c))}c&&a||Array.from(e.children).forEach(e=>this.register(e,i))}runner(){this.pointers.forEach(e=>e.run()),setTimeout(()=>this.runner(),200)}unregister(e){this.elements=this.elements.map(t=>{const{scope:s,unregister:i}=t;return s.element===e||e.contains(s.element)?i():t}),s(this.elements)}getSimpleElement(e){let t=[];return this.elements.forEach(s=>{s.scope.element===e&&t.push(s)}),t}}class n{constructor(e,s,i,r){this.directives=[],Object.assign(this,{instance:e,scope:r}),this.scope.element=s,s.setAttribute("sd-registered","true"),i.forEach(({type:e,value:s})=>{if(t(e).in(["sd-attr","sd-class","sd-on"])&&t(";").in(s)){const t=s.split(";");t.forEach(t=>this.directives.push(c.getDirective(this,e,t)))}else this.directives.push(c.getDirective(this,e,s))})}unregister(){return this.scope.element.removeAttribute("sd-registered"),this.directives.forEach(e=>{e instanceof p&&e.destroy(),e instanceof o&&(this.scope.element.innerHTML=e.originalHTML)}),this.instance.pointers=this.instance.pointers.map(e=>{const t=E.bubbleUp(e);return t.element===this?null:e}),s(this.instance.pointers),null}}class c{constructor(e,t){Object.assign(this,{element:e,expression:t,scope:e.scope})}static getDirective(e,t,s){const i="Sd"+t.substring(3,4).toUpperCase()+t.substring(4);return new x[i](e,s)}}class a extends c{constructor(e,t){super(e,t);const[s,r]=i(t);this.attribute=s,this.scope.attributeName=s,this.reference=E.getReference(this,r)}run(e){const s=this.attribute,i=this.scope.element;"value"===s&&"SELECT"===i.tagName?Array.from(i.getElementsByTagName("option")).forEach(s=>{Array.isArray(e)&&t(s.value).in(e)||e==s.value?s.selected=!0:s.selected=!1}):e?(i.setAttribute(s,e),"value"===s&&(i.value=e)):(i.hasAttribute(s)&&i.removeAttribute(s),"value"===s&&(i.value=""))}}class h extends c{constructor(e,t){super(e,t),this.cachedState=2;const[s,r]=i(t);this.classes=s.split(","),this.scope.classNames=this.classes,this.reference=E.getReference(this,r)}run(e){if(2===this.cachedState)this.cachedState=e?1:0;else if(e&&0===this.cachedState)this.cachedState=1;else{if(e||1!==this.cachedState)return;this.cachedState=0}const t=this.scope.element.classList;this.classes.forEach(s=>{e?t.contains(s)||t.add(s):t.contains(s)&&t.remove(s)})}}class o extends c{constructor(e,t){super(e,t);const[s,r]=i(t);Object.assign(this,{alias:s,originalChildren:this.scope.element.children.length,originalHTML:this.scope.element.innerHTML}),this.scope.itemName=this.alias,this.reference=E.getReference(this,r)}run(e){if(!e)return;const{instance:t,directives:s}=this.element,{appendChild:i,children:r,lastChild:n,removeChild:c,tagName:h}=this.scope.element,o=document.createElement("div");if(o.innerHTML=this.originalHTML.repeat(e.length),Array.from(r).forEach(e=>{t.unregister(e)}),r.length>o.children.length)Array.from(Array(r.length-o.children.length)).forEach(()=>{c(n)});else if(r.length<o.children.length){const e=Array.from(o.children).slice(r.length);e.forEach(e=>{i(e)})}Array.from(r).forEach((s,i)=>{const r=Math.floor(i/this.originalChildren),n=Object.assign({},this.scope);n[this.alias]=Object.assign({$collection:e,$index:r},e[r]),t.register(s,n)}),"SELECT"===h&&s.some(e=>{if(e instanceof a&&"value"===e.attribute)return setTimeout(()=>e.run(e.reference.get())),!0})}}class l extends c{constructor(e,t){super(e,t),this.reference=E.getReference(this,t)}run(e){const t=this.element.instance,s=this.scope.element;Array.from(s.children).forEach(e=>t.unregister(e)),s.innerHTML=e,Array.from(s.children).forEach(e=>t.register(e,this.scope))}}class u extends c{constructor(e,t){super(e,t),this.cachedState=2,this.reference=E.getReference(this,t)}run(e){if(2===this.cachedState)this.cachedState=e?1:0;else if(e&&0===this.cachedState)this.cachedState=1;else{if(e||1!==this.cachedState)return;this.cachedState=0}const{register:t,unregister:s}=this.element.instance,{style:i,children:r}=this.scope.element;e?(i.display=null,Array.from(r).forEach(e=>t(e,Object.assign({},this.scope)))):(i.display="none",Array.from(r).forEach(e=>s(e)))}}class d extends c{constructor(e,t){super(e,t),this.reference=E.getReference(this,t)}run(e){const t=this.scope.element.getAttribute("name"),s=Array.from(document.getElementsByName(t));s.forEach(t=>{t.value===e?t.checked=!0:t.checked=!1})}static isFirstRdoOfGroup(e,t){let s=!0;return e.elements.some(({scope:e})=>{"INPUT"===e.element.tagName&&"radio"===e.element.getAttribute("type")&&e.element.getAttribute("name")===t.getAttribute("name")&&(s=!1)}),s}}class p extends c{constructor(e,s){super(e,s);const[r,n]=i(s);this.events=r.split(","),this.scope.eventNames=this.events,this.actions=n.split(",").map(e=>"$update"===e?this.getUpdater():t("=").in(e)?new g(this,e):new m(this,e)),this.listener=(e=>this.actions.forEach(t=>t.run(e))),this.events.forEach(e=>this.scope.element.addEventListener(e,this.listener))}destroy(){this.events.forEach(e=>this.scope.element.removeEventListener(e,this.listener))}getUpdater(){const e=this.scope.element;return e.hasAttribute("sd-attr")?"INPUT"===e.tagName&&t(e.getAttribute("type")).in(["checkbox","radio"])?new v(this):new y(this):e.hasAttribute("sd-html")&&e.isContentEditable?new A(this):e.hasAttribute("sd-rdo")?new j(this):void 0}}class f{constructor(e){this.directive=e,this.scope=e.scope}}class m extends f{constructor(e,t){super(e),this.callee=E.getReference(this,t)}run(e){const t=this.callee.obj[this.callee.key],s=this.callee.args.map(e=>e.bang?!e.obj[e.key]:e.obj[e.key]);t.apply(Object.assign({event:e},this.scope),s)}}class g extends f{constructor(e,t){super(e);const s=t.split("=");this.left=E.getReference(this,s[0]),this.right=E.getReference(this,s[1])}run(){const e=this.right.get();this.left.obj[this.left.key]=e}}class b extends f{}class y extends b{constructor(e){super(e),this.directive.element.directives.some(e=>{if(e instanceof a&&"value"===e.attribute&&e.reference instanceof S)return this.updatee=e.reference,!0})}run(){const e=this.scope.element.value;"number"!=typeof this.updatee.obj[this.updatee.key]||isNaN(Number(e))?this.updatee.obj[this.updatee.key]=e:this.updatee.obj[this.updatee.key]=Number(e)}}class v extends b{constructor(e){super(e),this.directive.element.directives.some(e=>{if(e instanceof a&&"checked"===e.attribute&&e.reference instanceof S)return this.updatee=e.reference,!0})}run(){const e=this.scope.element;this.updatee.obj[this.updatee.key]=e.checked}}class A extends b{constructor(e){super(e),this.directive.element.directives.some(e=>{if(e instanceof l&&e.reference instanceof S)return this.updatee=e.reference,!0})}run(){const{innerHTML:e}=this.scope.element;this.updatee.obj[this.updatee.key]=e}}class j extends b{constructor(e){super(e),this.directive.element.directives.some(e=>{if(e instanceof l&&e.reference instanceof S)return this.updatee=e.reference,!0})}run(){const e=this.scope.element.getAttribute("name"),t=Array.from(document.getElementsByName(e));let s;t.some(e=>{if(e.checked)return s=e.value,!0}),this.updatee.obj[this.updatee.key]=s}}class E{constructor(e){this.parent=e,this.scope=e.scope}static bubbleUp(e){let t=e;for(;t instanceof E;)t=t.parent;return t}static getReference(e,t,s){return/[=<!>]/.test(t.substring(1))?new k(e,t,s):new S(e,t,s)}}class k extends E{constructor(e,t,s){super(e);const i=t.match(/([=<!>]{1,3})/)[0],r=t.indexOf(i);this.comparator=i,this.left=E.getReference(this,t.substring(0,r),s),this.right=E.getReference(this,t.substring(r+i.length),s)}get(){const e=this.left.get(),t=this.right.get();switch(this.comparator){case"==":return e==t;case"===":return e===t;case"!=":case"!==":return e!=t;case"<":return e<t;case">":return e>t;case"<=":return e<=t;case">=":return e>=t}}}class S extends E{constructor(e,t,s){super(e),this.args=[],this.bang=!1,t.startsWith("!")&&(this.bang=!0,t=t.substring(1));const[r,n]=i(t);this.base=r,n&&(this.args=n.split(":").map(e=>E.getReference(this,e,!0))),this.obj={value:t},this.key="value";let a=this.maybeGetObjAndKey(this.base,this.scope);if(a.nah&&(a=this.maybeGetObjAndKey(this.base)),a.nah||(this.obj=a.obj,this.key=a.key),!s){const e=E.bubbleUp(this);e instanceof c&&!(e instanceof p)&&(e.element.instance.pointers.push(this),this.run(!0))}}get(){let e=this.obj[this.key];if("function"==typeof e){const t=this.args.map(e=>e.bang?!e.obj[e.key]:e.obj[e.key]);e=e.apply(this.scope,t)}return this.bang?!e:e}maybeGetObjAndKey(e,s){const i={nah:!0},r=t("[").in(e);let n,a=t(".").in(e);if(s)n=s;else{let e=E.bubbleUp(this);e=e instanceof c?e.element.instance.root:e.directive.element.instance.root,n=e}if(/[^a-z0-9.[\]$_]/i.test(e))return i;if(!r&&!a)return n.hasOwnProperty(e)?{obj:n,key:e}:i;if(r){let t=!0;for(;/\[[^\[\]]*\]/.test(e);)e=e.replace(/\[([^\[\]]*)\]/g,(e,i)=>{const{obj:r,key:n}=this.maybeGetObjAndKey(i,s);return n?"."+r[n]:(t=!1,"")});if(!t)return i;a||(a=!0)}if(a){const t=e.split(".");let s;return t.some((e,i)=>{if(i===t.length-1)s=e;else{if("object"!=typeof n||!n.hasOwnProperty(e))return s=!1,!0;n=n[e]}}),"string"==typeof s?{obj:n,key:s}:i}}run(e){let t=this.get(),s=!1;if(Array.isArray(t)&&Array.isArray(this.value)?t.length!==this.value.length?s=!0:t.some((e,t)=>{if(e!==this.value[t])return s=!0,!0}):t!==this.value&&(s=!0),Array.isArray(t)&&(t=t.slice(0)),s||e){const{reference:e,run:s}=E.bubbleUp(this);this.value=t;try{s(e.get())}catch(t){setTimeout(()=>s(e.get()))}}}}const x={SdAttr:a,SdClass:h,SdFor:o,SdHtml:l,SdIf:u,SdRdo:d,SdOn:p};e.register=((e,t)=>new r(e,t))})(simpleDirectives);