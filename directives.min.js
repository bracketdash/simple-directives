const simpleDirectives={};(function(e){function t(e){let t;for(;-1!==(t=e.indexOf(null));)e.splice(t,1)}function s(e){const t=e.split(":"),s=t.shift(),i=t.join(":");return[s,i]}class i{constructor(e,t){this.elements=[],this.pointers=[],this.root=t||window,this.register(e||document.body),this.runner()}register(e,s){const i=Object.keys(x).map(e=>e.replace("d","d-").toLowerCase());let n,c=!1;if(e.hasAttributes()){let a=Array.from(e.attributes).map(({name:t,value:s})=>{const r="sd-rdo"!==t||u.isFirstRdoOfGroup(this,e);return S(t).in(i)&&r?(S(t).in(["sd-if","sd-for"])&&(c=!0),{type:t,value:s.replace(/\s+/g,"")}):null});t(a),a.length&&(n=new r(this,e,a,Object.assign({},s||{})),this.elements.push(n))}n&&c||Array.from(e.children).forEach(e=>this.register(e,s))}runner(){this.pointers.forEach(e=>e.run()),setTimeout(()=>this.runner(),200)}unregister(e){this.elements=this.elements.map(t=>t.scope.element===e||e.contains(t.scope.element)?t.unregister():t),t(this.elements)}getSimpleElement(e){let t=[];return this.elements.forEach(s=>{s.scope.element===e&&t.push(s)}),t}}class r{constructor(e,t,s,i){this.directives=[],Object.assign(this,{instance:e,scope:i}),this.scope.element=t,t.setAttribute("sd-registered","true"),s.forEach(({type:e,value:t})=>{if(S(e).in(["sd-attr","sd-class","sd-on"])&&S(";").in(t)){const s=t.split(";");s.forEach(t=>this.directives.push(n.getDirective(this,e,t)))}else this.directives.push(n.getDirective(this,e,t))})}unregister(){return this.scope.element.removeAttribute("sd-registered"),this.directives.forEach(e=>{e instanceof d&&e.destroy(),e instanceof o&&(this.scope.element.innerHTML=e.originalHTML)}),this.instance.pointers=this.instance.pointers.map(e=>{const t=j.bubbleUp(e);return t.element===this?null:e}),t(this.instance.pointers),null}}class n{constructor(e,t){Object.assign(this,{element:e,expression:t,scope:e.scope})}static getDirective(e,t,s){const i="Sd"+t.substring(3,4).toUpperCase()+t.substring(4);return new x[i](e,s)}}class c extends n{constructor(e,t){super(e,t);const[i,r]=s(t);this.attribute=i,this.scope.attributeName=i,this.reference=j.getReference(this,r)}run(e){const t=this.attribute,s=this.scope.element;"value"===t&&"SELECT"===s.tagName?Array.from(s.getElementsByTagName("option")).forEach(t=>{Array.isArray(e)&&S(t.value).in(e)||e==t.value?t.selected=!0:t.selected=!1}):e?(s.setAttribute(t,e),"value"===t&&(s.value=e)):(s.hasAttribute(t)&&s.removeAttribute(t),"value"===t&&(s.value=""))}}class a extends n{constructor(e,t){super(e,t),this.cachedState=2;const[i,r]=s(t);this.classes=i.split(","),this.scope.classNames=this.classes,this.reference=j.getReference(this,r)}run(e){if(2===this.cachedState)this.cachedState=e?1:0;else if(e&&0===this.cachedState)this.cachedState=1;else{if(e||1!==this.cachedState)return;this.cachedState=0}const t=this.scope.element.classList;this.classes.forEach(s=>{e?t.contains(s)||t.add(s):t.contains(s)&&t.remove(s)})}}class o extends n{constructor(e,t){super(e,t);const[i,r]=s(t);Object.assign(this,{alias:i,originalChildren:this.scope.element.children.length,originalHTML:this.scope.element.innerHTML}),this.scope.itemName=this.alias,this.reference=j.getReference(this,r)}run(e){if(!e)return;const{instance:t,directives:s}=this.element,i=this.scope.element,r=this.scope.element.children,n=document.createElement("div");if(n.innerHTML=this.originalHTML.repeat(e.length),Array.from(r).forEach(e=>{t.unregister(e)}),r.length>n.children.length)Array.from(Array(r.length-n.children.length)).forEach(()=>{i.removeChild(i.lastChild)});else if(r.length<n.children.length){const e=Array.from(n.children).slice(r.length);e.forEach(e=>{i.appendChild(e)})}Array.from(r).forEach((s,i)=>{const r=Math.floor(i/this.originalChildren),n=Object.assign({},this.scope);n[this.alias]=Object.assign({$collection:e,$index:r},e[r]),t.register(s,n)}),"SELECT"===i.tagName&&s.some(e=>{if(e instanceof c&&"value"===e.attribute)return setTimeout(()=>e.run(e.reference.get())),!0})}}class h extends n{constructor(e,t){super(e,t),this.reference=j.getReference(this,t)}run(e){const t=this.element.instance,s=this.scope.element;Array.from(s.children).forEach(e=>t.unregister(e)),s.innerHTML=e,Array.from(s.children).forEach(e=>t.register(e,this.scope))}}class l extends n{constructor(e,t){super(e,t),this.cachedState=2,this.reference=j.getReference(this,t)}run(e){if(2===this.cachedState)this.cachedState=e?1:0;else if(e&&0===this.cachedState)this.cachedState=1;else{if(e||1!==this.cachedState)return;this.cachedState=0}const t=this.element.instance,{style:s,children:i}=this.scope.element;e?(s.display=null,Array.from(i).forEach(e=>t.register(e,Object.assign({},this.scope)))):(s.display="none",Array.from(i).forEach(e=>t.unregister(e)))}}class u extends n{constructor(e,t){super(e,t),this.reference=j.getReference(this,t)}run(e){const t=this.scope.element.getAttribute("name"),s=Array.from(document.getElementsByName(t));s.forEach(t=>{t.value===e?t.checked=!0:t.checked=!1})}static isFirstRdoOfGroup(e,t){let s=!0;return e.elements.some(({scope:e})=>{"INPUT"===e.element.tagName&&"radio"===e.element.getAttribute("type")&&e.element.getAttribute("name")===t.getAttribute("name")&&(s=!1)}),s}}class d extends n{constructor(e,t){super(e,t);const[i,r]=s(t);this.events=i.split(","),this.scope.eventNames=this.events,this.actions=r.split(",").map(e=>"$update"===e?this.getUpdater():S("=").in(e)?new m(this,e):new f(this,e)),this.listener=(e=>this.actions.forEach(t=>t.run(e))),this.events.forEach(e=>this.scope.element.addEventListener(e,this.listener))}destroy(){this.events.forEach(e=>this.scope.element.removeEventListener(e,this.listener))}getUpdater(){const e=this.scope.element;return e.hasAttribute("sd-attr")?"INPUT"===e.tagName&&S(e.getAttribute("type")).in(["checkbox","radio"])?new y(this):new b(this):e.hasAttribute("sd-html")&&e.isContentEditable?new v(this):e.hasAttribute("sd-rdo")?new A(this):void 0}}class p{constructor(e){this.directive=e,this.scope=e.scope}}class f extends p{constructor(e,t){super(e),this.callee=j.getReference(this,t)}run(e){const t=this.callee.obj[this.callee.key],s=this.callee.args.map(e=>e.bang?!e.obj[e.key]:e.obj[e.key]);t.apply(Object.assign({event:e},this.scope),s)}}class m extends p{constructor(e,t){super(e);const s=t.split("=");this.left=j.getReference(this,s[0]),this.right=j.getReference(this,s[1])}run(){const e=this.right.get();this.left.obj[this.left.key]=e}}class g extends p{}class b extends g{constructor(e){super(e),this.directive.element.directives.some(e=>{if(e instanceof c&&"value"===e.attribute&&e.reference instanceof k)return this.updatee=e.reference,!0})}run(){const e=this.scope.element.value;"number"!=typeof this.updatee.obj[this.updatee.key]||isNaN(Number(e))?this.updatee.obj[this.updatee.key]=e:this.updatee.obj[this.updatee.key]=Number(e)}}class y extends g{constructor(e){super(e),this.directive.element.directives.some(e=>{if(e instanceof c&&"checked"===e.attribute&&e.reference instanceof k)return this.updatee=e.reference,!0})}run(){const e=this.scope.element;this.updatee.obj[this.updatee.key]=e.checked}}class v extends g{constructor(e){super(e),this.directive.element.directives.some(e=>{if(e instanceof h&&e.reference instanceof k)return this.updatee=e.reference,!0})}run(){const{innerHTML:e}=this.scope.element;this.updatee.obj[this.updatee.key]=e}}class A extends g{constructor(e){super(e),this.directive.element.directives.some(e=>{if(e instanceof h&&e.reference instanceof k)return this.updatee=e.reference,!0})}run(){const e=this.scope.element.getAttribute("name"),t=Array.from(document.getElementsByName(e));let s;t.some(e=>{if(e.checked)return s=e.value,!0}),this.updatee.obj[this.updatee.key]=s}}class j{constructor(e){this.parent=e,this.scope=e.scope}static bubbleUp(e){let t=e;for(;t instanceof j;)t=t.parent;return t}static getReference(e,t,s){return/[=<!>]/.test(t.substring(1))?new E(e,t,s):new k(e,t,s)}}class E extends j{constructor(e,t,s){super(e);const i=t.match(/([=<!>]{1,3})/)[0],r=t.indexOf(i);this.comparator=i,this.left=j.getReference(this,t.substring(0,r),s),this.right=j.getReference(this,t.substring(r+i.length),s)}get(){const e=this.left.get(),t=this.right.get();switch(this.comparator){case"==":return e==t;case"===":return e===t;case"!=":case"!==":return e!=t;case"<":return e<t;case">":return e>t;case"<=":return e<=t;case">=":return e>=t}}}class k extends j{constructor(e,t,i){super(e),this.args=[],this.bang=!1,t.startsWith("!")&&(this.bang=!0,t=t.substring(1));const[r,c]=s(t);this.base=r,c&&(this.args=c.split(":").map(e=>j.getReference(this,e,!0))),this.obj={value:t},this.key="value";let a=this.maybeGetObjAndKey(this.base,this.scope);if(a.nah&&(a=this.maybeGetObjAndKey(this.base)),a.nah||(this.obj=a.obj,this.key=a.key),!i){const e=j.bubbleUp(this);e instanceof n&&!(e instanceof d)&&(e.element.instance.pointers.push(this),this.run(!0))}}get(){let e=this.obj[this.key];if("function"==typeof e){const t=this.args.map(e=>e.bang?!e.obj[e.key]:e.obj[e.key]);e=e.apply(this.scope,t)}return this.bang?!e:e}maybeGetObjAndKey(e,t){const s={nah:!0},i=S("[").in(e);let r,c=S(".").in(e);if(t)r=t;else{let e=j.bubbleUp(this);e=e instanceof n?e.element.instance.root:e.directive.element.instance.root,r=e}if(/[^a-z0-9.[\]$_]/i.test(e))return s;if(!i&&!c)return r.hasOwnProperty(e)?{obj:r,key:e}:s;if(i){let i=!0;for(;/\[[^\[\]]*\]/.test(e);)e=e.replace(/\[([^\[\]]*)\]/g,(e,s)=>{const{obj:r,key:n}=this.maybeGetObjAndKey(s,t);return n?"."+r[n]:(i=!1,"")});if(!i)return s;c||(c=!0)}if(c){const t=e.split(".");let i;if(r[t[0]]&&r[t[0]].$collection&&"$collection"!==t[1]&&"$index"!==t[1]){const e=r[t[0]].$collection[r[t[0]].$index];r={},r[t[0]]=e}return t.some((e,s)=>{if(s===t.length-1)i=e;else{if("object"!=typeof r||!r.hasOwnProperty(e))return i=!1,!0;r=r[e]}}),"string"==typeof i?{obj:r,key:i}:s}}run(e){let t=this.get(),s=!1;if(Array.isArray(t)&&Array.isArray(this.value)?t.length!==this.value.length?s=!0:t.some((e,t)=>{if(e!==this.value[t])return s=!0,!0}):t!==this.value&&(s=!0),Array.isArray(t)&&(t=t.slice(0)),s||e){const e=j.bubbleUp(this);this.value=t;try{e.run(e.reference.get())}catch(t){setTimeout(()=>e.run(e.reference.get()))}}}}const S=e=>({in:t=>-1!==t.indexOf(e)}),x={SdAttr:c,SdClass:a,SdFor:o,SdHtml:h,SdIf:l,SdRdo:u,SdOn:d};e.register=((e,t)=>new i(e,t))})(simpleDirectives);