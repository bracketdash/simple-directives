const simpleDirectives={};(function(e){function t(e,t){const s={},i=function(){const i=Date.now();let r=Array.from(arguments);return r.unshift(this),r=r.map(e=>{switch(typeof e){case"object":return null===e?"null":JSON.stringify(e);case"boolean":case"number":case"function":return e.toString();case"string":return e;default:return typeof e}}).join(""),(!s.hasOwnProperty(r)||i>s[r].expires)&&(s[r]={value:e.apply(this,arguments),expires:i+(t||1e3)}),s[r].value};return i}function s(e){let t;for(;-1!==(t=e.indexOf(null));)e.splice(t,1)}function i(e){const t=e.split(":"),s=t.shift(),i=t.join(":");return[s,i]}class r{constructor(e,t){this.elements=[],this.pointers=[],this.root=t||window,this.register(e||document.body),this.runner()}register(e,t){const i=Object.keys(x).map(e=>e.replace("d","d-").toLowerCase());let r,c=!1;if(e.hasAttributes()){let o=Array.from(e.attributes).map(({name:t,value:s})=>{const r="sd-rdo"!==t||p.isFirstRdoOfGroup(this,e);return O(t).in(i)&&r?(O(t).in(["sd-if","sd-for"])&&(c=!0),{type:t,value:s.replace(/\s+/g,"")}):null});s(o),o.length&&(r=new n(this,e,o,Object.assign({},t||{})),this.elements.push(r))}r&&c||Array.from(e.children).forEach(e=>this.register(e,t))}runner(){this.pointers.forEach(e=>{e.valid&&e.run()}),setTimeout(()=>this.runner(),100)}unregister(e){this.elements=this.elements.map(t=>t.scope.element===e||e.contains(t.scope.element)?t.unregister():t),s(this.elements)}getSimpleElement(e){let t=[];return this.elements.forEach(s=>{s.scope.element===e&&t.push(s)}),t}}class n{constructor(e,t,s,i){this.directives=[],Object.assign(this,{instance:e,scope:i}),this.scope.element=t,t.setAttribute("sd-registered","true"),s.sort((e,t)=>"sd-if"===e.type&&"sd-if"!==t.type?1:"sd-for"!==e.type||O(t.type).in(["sd-if","sd-for"])?"on"===e.type&&"on"!==t.type?-1:void 0:1),s.forEach(({type:e,value:t})=>{if(O(e).in(["sd-attr","sd-class","sd-on"])&&O(";").in(t)){const s=t.split(";");s.forEach(t=>this.directives.push(c.getDirective(this,e,t)))}else this.directives.push(c.getDirective(this,e,t))}),this.instance.pointers.sort((e,t)=>{const s=k.bubbleUp(e).constructor.toString().split(" ")[1],i=k.bubbleUp(t).constructor.toString().split(" ")[1];return"SdIf"===s&&"SdIf"!==i?-1:"SdFor"!==s||O(i).in(["SdIf","SdFor"])?0:-1})}unregister(){return this.scope.element.removeAttribute("sd-registered"),this.directives.forEach(e=>{e instanceof d&&e.destroy(),e instanceof h&&(this.scope.element.innerHTML=e.originalHTML)}),this.instance.pointers=this.instance.pointers.map(e=>{const t=k.bubbleUp(e);return t.element===this?(e.valid=!1,null):e}),s(this.instance.pointers),null}}class c{constructor(e,t){Object.assign(this,{element:e,expression:t,scope:e.scope})}static getDirective(e,t,s){const i="Sd"+t.substring(3,4).toUpperCase()+t.substring(4);return new x[i](e,s)}}class o extends c{constructor(e,t){super(e,t);const[s,r]=i(t);this.attribute=s,this.scope.attributeName=s,this.reference=k.getReference(this,r)}run(e){const t=this.attribute,s=this.scope.element;"value"===t&&"SELECT"===s.tagName?Array.from(s.getElementsByTagName("option")).forEach(t=>{Array.isArray(e)&&O(t.value).in(e)||e==t.value?t.selected=!0:t.selected=!1}):e?(s.setAttribute(t,e),"value"===t&&(s.value=e)):(s.hasAttribute(t)&&s.removeAttribute(t),"value"===t&&(s.value=""))}}class a extends c{constructor(e,t){super(e,t),this.cachedState=2;const[s,r]=i(t);this.classes=s.split(","),this.scope.classNames=this.classes,this.reference=k.getReference(this,r)}run(e){if(2===this.cachedState)this.cachedState=e?1:0;else if(e&&0===this.cachedState)this.cachedState=1;else{if(e||1!==this.cachedState)return;this.cachedState=0}const t=this.scope.element.classList;this.classes.forEach(s=>{e?t.contains(s)||t.add(s):t.contains(s)&&t.remove(s)})}}class h extends c{constructor(e,t){super(e,t);const[s,r]=i(t);Object.assign(this,{alias:s,originalChildren:this.scope.element.children.length,originalHTML:this.scope.element.innerHTML}),this.scope.itemName=this.alias,this.reference=k.getReference(this,r)}run(e){if(!e)return;const{instance:t,directives:s}=this.element,i=this.scope.element,r=this.scope.element.children,n=document.createElement("div");if(n.innerHTML=this.originalHTML.repeat(e.length),Array.from(r).forEach(e=>{t.unregister(e)}),r.length>n.children.length)Array.from(Array(r.length-n.children.length)).forEach(()=>{i.removeChild(i.lastChild)});else if(r.length<n.children.length){const e=Array.from(n.children).slice(r.length);e.forEach(e=>{i.appendChild(e)})}Array.from(r).forEach((s,i)=>{const r=Math.floor(i/this.originalChildren),n=Object.assign({},this.scope);n[this.alias]=Object.assign({$collection:e,$index:r},e[r]),this.handleSdForUniques(s,"sd"+r),t.register(s,n)}),"SELECT"===i.tagName&&s.some(e=>{if(e instanceof o&&"value"===e.attribute)return setTimeout(()=>e.reference.get(t=>e.run(t))),!0})}handleSdForUniques(e,t){const s=e.getAttribute("sd-for-unique");s&&s.split(",").forEach(s=>{const i=e.getAttribute(s);i?e.setAttribute(s,i+t):e.setAttribute(s,"sdForUnique"+t)}),Array.from(e.children).forEach(e=>this.handleSdForUniques(e,t))}}class l extends c{constructor(e,t){super(e,t),this.reference=k.getReference(this,t)}run(e){const t=this.element.instance,s=this.scope.element;Array.from(s.children).forEach(e=>t.unregister(e)),s.innerHTML=e,Array.from(s.children).forEach(e=>t.register(e,this.scope))}}class u extends c{constructor(e,t){super(e,t),this.cachedState=2,this.reference=k.getReference(this,t)}run(e){if(2===this.cachedState)this.cachedState=e?1:0;else if(e&&0===this.cachedState)this.cachedState=1;else{if(e||1!==this.cachedState)return;this.cachedState=0}const t=this.element.instance,{style:s,children:i}=this.scope.element;e?(s.display=null,Array.from(i).forEach(e=>t.register(e,Object.assign({},this.scope)))):(s.display="none",Array.from(i).forEach(e=>t.unregister(e)))}}class p extends c{constructor(e,t){super(e,t),this.reference=k.getReference(this,t)}run(e){const t=this.scope.element.getAttribute("name"),s=Array.from(document.getElementsByName(t));s.forEach(t=>{t.value===e?t.checked=!0:t.checked=!1})}static isFirstRdoOfGroup(e,t){return!e.elements.some(({scope:e})=>"INPUT"===e.element.tagName&&"radio"===e.element.getAttribute("type")&&e.element.getAttribute("name")===t.getAttribute("name"))}}class d extends c{constructor(e,t){super(e,t);const[r,n]=i(t);this.events=r.split(","),this.scope.eventNames=this.events,this.actions=n.split(",").map(e=>"$update"===e?this.getUpdater():O("=").in(e)?new b(this,e):new m(this,e)),s(this.actions),this.listener=(e=>this.actions.forEach(t=>t.run(e))),this.events.forEach(e=>this.scope.element.addEventListener(e,this.listener))}destroy(){this.events.forEach(e=>this.scope.element.removeEventListener(e,this.listener))}getUpdater(){const e=this.scope.element;return e.hasAttribute("sd-attr")?"INPUT"===e.tagName&&O(e.getAttribute("type")).in(["checkbox","radio"])?new v(this):new y(this):e.hasAttribute("sd-html")&&e.isContentEditable?new A(this):"INPUT"===e.tagName&&"radio"===e.getAttribute("type")&&e.hasAttribute("name")&&(e.hasAttribute("sd-rdo")||Array.from(document.querySelectorAll('input[name="'+e.getAttribute("name")+'"]')).some(e=>e.hasAttribute("sd-rdo")))?new j(this):null}}class f{constructor(e){this.directive=e,this.scope=e.scope}}class m extends f{constructor(e,t){super(e),this.action=t,this.callee=k.getReference(this,t)}doApply(e){const t=this.callee.obj[this.callee.key],s=this.callee.args.map(e=>e.bang?!e.obj[e.key]:e.obj[e.key]);t.apply(Object.assign({event:e},this.scope),s)}run(e){this.callee.obj&&this.callee.obj.hasOwnProperty(this.callee.key)?this.doApply(e):setTimeout(()=>{this.callee.tryRelink(),this.callee.obj&&this.callee.obj.hasOwnProperty(this.callee.key)&&this.doApply(e)})}}class b extends f{constructor(e,t){super(e),this.action=t;const s=t.split("=");this.left=k.getReference(this,s[0]),this.right=k.getReference(this,s[1])}run(){this.right.get(e=>{this.left.obj[this.left.key]=e})}}class g extends f{}class y extends g{constructor(e){super(e),this.directive.element.directives.some(e=>{if(e instanceof o&&"value"===e.attribute&&e.reference instanceof E)return this.updatee=e.reference,!0})}run(){const e=this.scope.element.value;"number"!=typeof this.updatee.obj[this.updatee.key]||isNaN(Number(e))?this.updatee.obj[this.updatee.key]=e:this.updatee.obj[this.updatee.key]=Number(e)}}class v extends g{constructor(e){super(e),this.directive.element.directives.some(e=>{if(e instanceof o&&"checked"===e.attribute&&e.reference instanceof E)return this.updatee=e.reference,!0})}run(){const e=this.scope.element;this.updatee.obj[this.updatee.key]=e.checked}}class A extends g{constructor(e){super(e),this.directive.element.directives.some(e=>{if(e instanceof l&&e.reference instanceof E)return this.updatee=e.reference,!0})}run(){const{innerHTML:e}=this.scope.element;this.updatee.obj[this.updatee.key]=e}}class j extends g{constructor(e){super(e);const t=this.directive.element.instance;setTimeout(()=>{const e=document.querySelectorAll(`input[name="${this.scope.element.getAttribute("name")}"]`);Array.from(e).some(e=>{const s=t.getSimpleElement(e);s.length&&s[0].directives.some(e=>{if(e instanceof p&&e.reference instanceof E)return this.updatee=e.reference,!0})})})}run(){const e=this.scope.element.getAttribute("name"),t=Array.from(document.getElementsByName(e));let s;t.some(e=>{if(e.checked)return s=e.value,!0}),this.updatee.obj[this.updatee.key]=s}}class k{constructor(e){this.parent=e,this.scope=e.scope}static bubbleUp(e){let t=e;for(;t instanceof k;)t=t.parent;return t}static getReference(e,t,s){return/[=<!>]/.test(t.substring(1))?new S(e,t,s):new E(e,t,s)}}class S extends k{constructor(e,t,s){super(e);const i=t.match(/([=<!>]{1,3})/)[0],r=t.indexOf(i);this.comparison=t,this.comparator=i,this.left=k.getReference(this,t.substring(0,r),s),this.right=k.getReference(this,t.substring(r+i.length),s)}get(e){this.left.get(t=>{this.right.get(s=>{switch(this.comparator){case"==":e(t==s);break;case"===":e(t===s);break;case"!=":case"!==":e(t!=s);break;case"<":e(t<s);break;case">":e(t>s);break;case"<=":e(t<=s);break;case">=":e(t>=s)}})})}}class E extends k{constructor(e,t,s){super(e),this.args=[],this.bang=!1,this.valid=!0,t.startsWith("!")&&(this.bang=!0,t=t.substring(1));const[r,n]=i(t);this.base=r,n&&(this.args=n.split(":").map(e=>k.getReference(this,e,!0)));const{obj:o,key:a}=this.getObjAndKey(this.base,this.scope);if(this.obj=o,this.key=a,!s){const e=k.bubbleUp(this);e instanceof c&&!(e instanceof d)&&(e.element.instance.pointers.push(this),this.run(!0))}}get(e){let t,s=this.obj[this.key];"function"==typeof s&&(this.args.some(e=>!e.obj||!e.obj.hasOwnProperty(e.key))?setTimeout(()=>{t=this.args.map(e=>(e.obj&&e.obj.hasOwnProperty(e.key)||e.tryRelink(),e.bang?!e.obj[e.key]:e.obj[e.key])),s=s.apply(this.scope,t),e(this.bang?!s:s)}):(t=this.args.map(e=>e.bang?!e.obj[e.key]:e.obj[e.key]),s=s.apply(this.scope,t))),e(this.bang?!s:s)}getObjAndKey(e,t){let s={value:e},i="value",r=this.maybeGetObjAndKey(e,t,!1);return r.nah&&(r=this.maybeGetObjAndKey(e,t,!0)),r.nah||(s=r.obj,i=r.key),{obj:s,key:i}}maybeGetObjAndKey(e,t,s){const i={nah:!0},r=O("[").in(e);let n,o=O(".").in(e),a=e;if(t&&!s)n=t;else{let e=k.bubbleUp(this);e=e instanceof c?e.element.instance.root:e.directive.element.instance.root,n=e}if(/[^a-z0-9.[\]$_]/i.test(e))return i;if(!r&&!o)return n.hasOwnProperty(e)?{obj:n,key:e}:i;if(r){for(;/\[[^\[\]]*\]/.test(a);)a=a.replace(/\[([^\[\]]*)\]/g,(e,s)=>{const{obj:i,key:r}=this.getObjAndKey(s,t);return"."+i[r]});o||(o=!0)}if(o){const e=a.split(".");let t;if(n[e[0]]&&n[e[0]].$collection&&"$collection"!==e[1]&&"$index"!==e[1]){const t=n[e[0]].$collection[n[e[0]].$index];n={},n[e[0]]=t}return e.some((s,i)=>{if(i===e.length-1)t=s;else{if("object"!=typeof n||!n.hasOwnProperty(s))return t=!1,!0;n=n[s]}}),"string"==typeof t?{obj:n,key:t}:i}}run(e){this.get(t=>{let s=t,i=!1;if(Array.isArray(s)&&Array.isArray(this.value)?s.length!==this.value.length?i=!0:s.some((e,t)=>{if(e!==this.value[t])return i=!0,!0}):void 0!==s&&s.toString&&"NaN"===s.toString()?this.value&&this.value.toString&&"NaN"===this.value.toString()&&(i=!0):s!==this.value&&(i=!0),Array.isArray(s)&&(s=s.slice(0)),i||e){const e=k.bubbleUp(this);this.value=s;try{e.reference.get(t=>e.run(t))}catch(t){setTimeout(()=>e.reference.get(t=>e.run(t)))}}})}tryRelink(){const{obj:e,key:t}=this.getObjAndKey(this.base,this.scope);this.obj=e,this.key=t}}const O=e=>({in:t=>-1!==t.indexOf(e)}),x={SdAttr:o,SdClass:a,SdFor:h,SdHtml:l,SdIf:u,SdRdo:p,SdOn:d};e.register=((e,t)=>new r(e,t)),e.memoize=t})(simpleDirectives);