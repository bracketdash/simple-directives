const simpleDirectives={};(function(e){function t(e){return{oneOf:t=>-1!==t.indexOf(e)}}function s(e){let t;for(;-1!==(t=e.indexOf(null));)e.splice(t,1)}class i{constructor(e,t){this.elements=[],this.references=[],this.root=t||window,this.register(e||document.body),this.runner()}register(e,s){let i,n=!1;["attr","class","for","html","if","on","rdo"].some(t=>{if(e.hasAttribute(`sd-${t}`))return n=!0,!0}),n&&!t(e).oneOf(this.elements)&&(i=new r(this,e,s),this.elements.push(i)),i&&!i.on||Array.from(e.children).forEach(e=>this.register(e,s))}runner(){this.references.forEach(e=>e.run()),setTimeout(()=>{this.runner()},200)}unregister(e){this.elements=this.elements.map(t=>t.raw===e||e.contains(t.raw)?t.unregister():t),s(this.elements)}getSimpleElement(e){let t;return this.elements.some(s=>{if(s.raw===e)return t=s,!0}),t}}class r{constructor(e,t,s){this.directives=[],this.instance=e,this.raw=t,this.scope=s||{},this.on=!0,["if","for","attr","class","html","rdo","on"].forEach(e=>{const s=t.getAttribute(`sd-${e}`);if(s){const t=new n(this,e,s.replace(/\s+/g,""));this.directives.push(t),"for"===e&&(this.on=!1)}})}unregister(){const e=this.directives.map(e=>e.type);return t("on").oneOf(e)&&this.directives.some(e=>{if("on"===e.type)return e.listeners.forEach(e=>e.destroy()),!0}),this.instance.references=this.instance.references.map(e=>{const t=x.bubbleUp(e);return t instanceof a&&this.raw.contains(t.directive.element.raw)?null:e}),s(this.instance.references),null}}class n{constructor(e,t,s){const i=s.split(";");this.raw=s,this.type=t,this.element=e,"on"===t?this.listeners=i.map(e=>new d(this,e)):this.expressions=this.getExpressions(i)}getExpressions(e){return e.map(e=>{switch(this.type){case"if":return new c(this,e);case"attr":return new h(this,e);case"class":return new o(this,e);case"for":return new l(this,e);case"html":return new u(this,e);case"rdo":return new f(this,e)}})}}class a{constructor(e,t,s){this.raw=t,this.directive=e,s||this.assignReference(t)}assignReference(e){const t=x.getReference(this,e);return this.directive.element.instance.references.push(t),t}run(e){}}class c extends a{run(e){const t=this.directive.element;t.on=!!e,e?(t.raw.style.display=null,Array.from(t.raw.children).forEach(e=>t.instance.register(e))):(t.raw.style.display="none",Array.from(t.raw.children).forEach(e=>t.instance.unregister(e)))}}class h extends a{constructor(e,t){const s=t.split(":");super(e,t,!0),this.attribute=s.shift(),this.assignReference(s.join(":"))}run(e){const s=this.directive.element.raw;"value"===this.attribute&&"SELECT"===s.tagName?Array.from(s.getElementsByTagName("option")).forEach(s=>{Array.isArray(e)&&t(s.value).oneOf(e)||e==s.value?s.selected=!0:s.selected=!1}):e?s.setAttribute(this.attribute,e):s.hasAttribute(this.attribute)&&s.removeAttribute(this.attribute)}}class o extends a{constructor(e,t){const s=t.split(":");super(e,t,!0),this.classes=s.shift().split(","),this.assignReference(s.join(":"))}run(e){const t=this.directive.element.raw;this.classes.forEach(s=>{e?t.classList.contains(s)||t.classList.add(s):t.classList.contains(s)&&t.classList.remove(s)})}}class l extends a{constructor(e,t){const s=t.split(":");super(e,t,!0),this.alias=s.shift(),this.originalHTML=this.directive.element.raw.innerHTML,this.assignReference(s.join(":"))}run(e){const t=e,s=this.directive.element,i=s.raw,r=i.children.length;if(this.directive.element.on){if(r){const e=t.length-r;if(Array.from(i.children).forEach(e=>s.instance.unregister(e)),e<0){let t=Math.abs(e);for(;t>0;)i.removeChild(i.lastChild),t-=1}else e>0&&(i.innerHTML+=this.originalHTML.repeat(e))}}else this.directive.element.on=!0,i.innerHTML=this.originalHTML.repeat(t.length);Array.from(i.children).some((e,i)=>{const r=Object.assign({},this.directive.element.scope);r[this.alias]=Object.assign({$collection:t,$index:i},t[i]),s.instance.register(e,r)}),"SELECT"===i.tagName&&s.directives.some(e=>{if("attr"===e.type)return e.expressions.some(e=>{if("value"===e.attribute)return setTimeout(()=>e.run(e.reference.get())),!0}),!0})}}class u extends a{run(e){const t=this.directive.element.instance,s=this.directive.element;Array.from(s.raw.children).forEach(e=>t.unregister(e)),s.raw.innerHTML=e,Array.from(s.raw.children).forEach(e=>t.register(e))}}class f extends a{run(e){const t=this.directive.element.raw.getAttribute("name"),s=Array.from(document.getElementsByName(t));s.forEach(t=>{t.value===e?t.checked=!0:t.checked=!1})}}class d{constructor(e,t){let s=t.split(":");this.directive=e,this.events=s.shift().split(","),this.raw=t,s=s.join(":").split(","),this.actions=s.map(e=>"$update"===e?this.getUpdater():-1!==e.indexOf("=")?new g(this,e):new p(this,e)),this.elo=(e=>this.actions.forEach(t=>t.run(e))),this.events.forEach(e=>this.directive.element.raw.addEventListener(e,this.elo))}destroy(){this.events.forEach(e=>{this.directive.element.raw.removeEventListener(e,this.elo)})}getUpdater(){const e=this.directive.element,s=e.directives.map(e=>e.type);return t("attr").oneOf(s)?"INPUT"===e.raw.tagName&&t(e.raw.getAttribute("type")).oneOf(["checkbox","radio"])?new w(this):new v(this):t("html").oneOf(s)&&e.raw.isContentEditable?new y(this):t("rdo").oneOf(s)?new E(this):void 0}}class m{constructor(e,t){this.listener=e,t&&(this.raw=t)}run(e){}}class p extends m{constructor(e,t){super(e,t),this.callee=x.getReference(this,t)}run(e){this.callee.get({event:e})}}class g extends m{constructor(e,t){const s=t.split("=");super(e,t),this.left=x.getReference(this,s.shift()),this.right=x.getReference(this,s[0])}run(){const e=this.right.get();this.left.obj[this.left.key]=e}}class b extends m{}class v extends b{run(){const e=this.listener.directive.element.raw;this.updatee.obj[this.updatee.key]=e.value}}class w extends b{run(){const e=this.listener.directive.element.raw;this.updatee.obj[this.updatee.key]=e.checked}}class y extends b{run(){const e=this.listener.directive.element.raw;this.updatee.obj[this.updatee.key]=e.innerHTML}}class E extends b{run(){const e=this.listener.directive.element.raw.getAttribute("name"),t=Array.from(document.getElementsByName(e));let s;t.some(e=>{if(e.checked)return s=e.value,!0}),this.updatee.obj[this.updatee.key]=s}}class x{constructor(e,t){this.parent=e,this.raw=t}get(e){}run(){let e=this.get(),t=e;"object"==typeof t&&(t=JSON.stringify(t)),t!==this.value&&(this.value=t,x.bubbleUp(this).run(e))}static bubbleUp(e){let t=e;for(;t instanceof x;)t=t.parent;return t}static getReference(e,t){let s;return s=/[=<!>]/.test(t.substring(1))?new j(e,t):new A(e,t),s}}class j extends x{constructor(e,t){const s=t.match(/([=<!>]{1,3})/)[0],i=t.indexOf(s);super(e,t),this.comparator=s,this.left=x.getReference(this,t.substring(0,i)),this.right=x.getReference(this,t.substring(i+s.length)),e instanceof a&&this.run()}get(e){const t=this.left.get(e),s=this.right.get(e);switch(this.comparator){case"==":return t==s;case"===":return t===s;case"!=":case"!==":return t!=s;case"<":return t<s;case">":return t>s;case"<=":return t<=s;case">=":return t>=s}}}class A extends x{constructor(e,t){const s=t.split(":");super(e,t),this.base=s.shift(),this.obj={value:t},this.key="value",this.base.startsWith("!")&&(this.bang=!0,this.base=this.base.substring(1)),this.args=s.map(e=>x.getReference(this,e));let i=x.bubbleUp(this.parent);i=i instanceof m?i.listener.directive:i.directive,this.scope=i.element.scope,this.scope.element=i.element.raw,i instanceof h?this.scope.attributeName=i.attribute:i instanceof o?this.scope.classNames=i.classes:i instanceof l?this.scope.itemName=i.alias:i instanceof d&&(this.scope.eventNames=i.events);let r=this.maybeGetObjAndKey(this.base,this.scope);r.nah&&(r=this.maybeGetObjAndKey(this.base)),r.nah||(this.obj=r.obj,this.key=r.key),e instanceof a&&this.run()}get(e){let t=x.bubbleUp(this.parent),s=this.obj[this.key];t=t instanceof a?t.directive:t.listener.directive;let i=this.scope;if(e&&(i=Object.assign({},i,e)),"function"==typeof s){const t=this.args.map(t=>t.get(e));s=s.apply(i,t)}return this.bang?!s:s}maybeGetObjAndKey(e,t){const s={nah:!0},i=-1!==e.indexOf("[");let r,n=-1!==e.indexOf(".");if(t)r=t;else{let e=x.bubbleUp(this.parent);e=e instanceof a?e.directive.element.instance.root:e.listener.directive.element.instance.root,r=e}if(/[^a-z0-9.[\]$_]/i.test(e))return s;if(!i&&!n)return r.hasOwnProperty(e)?{obj:r,key:e}:s;if(i){for(;/\[[^\[\]]*\]/.test(e);)e=e.replace(/\[([^\[\]]*)\]/g,(e,s)=>{const i=this.maybeGetObjAndKey(s,t);return"."+i.obj[i.key]});n||(n=!0)}if(n){const t=e.split(".");let i;return t.some((e,s)=>{if(s===t.length-1)i=e;else{if("object"!=typeof r||!r.hasOwnProperty(e))return i=!1,!0;r=r[e]}}),"string"==typeof i?{obj:r,key:i}:s}}}e.register=((e,t)=>new i(e,t))})(simpleDirectives);