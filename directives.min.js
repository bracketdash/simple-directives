const simpleDirectives={};(function(e){function t(e){return{oneOf(t){let s=!1;return t.some(t=>{if(t===e)return s=!0,!0}),s}}}function s(e){let t;for(;-1!==(t=e.indexOf(null));)e.splice(t,1)}class r{constructor(e,t){this.elements=[],this.references=[],this.root=t||window,this.register(e||document.body),this.runner()}register(e,s){let r,n=!1,c=!1;["attr","class","for","html","if","on","rdo"].some(s=>{if(e.hasAttribute(`sd-${s}`))return n=!0,t(s).oneOf(["if","for"])&&(c=!0),!0}),!n||t(e).oneOf(this.elements.map(e=>e.raw))||e.hasAttribute("sd-rdo")&&!f.isFirstRdoOfGroup(this,e)||(r=new i(this,e,s),this.elements.push(r)),r&&c||Array.from(e.children).forEach(e=>this.register(e,s))}runner(){this.references.forEach(e=>e.run()),setTimeout(()=>{this.runner()},200)}unregister(e){this.elements=this.elements.map(t=>t.raw===e||e.contains(t.raw)?t.unregister():t),s(this.elements)}getSimpleElement(e){let t;return this.elements.some(s=>{if(s.raw===e)return t=s,!0}),t}}class i{constructor(e,t,s){this.directives=[],this.instance=e,this.raw=t,this.scope=s||{},["if","for","attr","class","html","rdo","on"].forEach(e=>{const s=t.getAttribute(`sd-${e}`);if(s){const t=new n(this,e,s.replace(/\s+/g,""));this.directives.push(t)}})}unregister(){const e=this.directives.map(e=>e.type);return t("on").oneOf(e)&&this.directives.some(e=>{if("on"===e.type)return e.listeners.forEach(e=>e.destroy()),!0}),t("for").oneOf(e)&&this.directives.some(e=>{if("for"===e.type)return this.raw.innerHTML=e.expressions[0].originalHTML,!0}),this.instance.references=this.instance.references.map(e=>{const t=A.bubbleUp(e);return t instanceof c&&this.raw.contains(t.directive.element.raw)?null:e}),s(this.instance.references),null}}class n{constructor(e,t,s){const r=s.split(";");this.raw=s,this.type=t,this.element=e,"on"===t?this.listeners=r.map(e=>new d(this,e)):this.expressions=this.getExpressions(r)}getExpressions(e){return e.map(e=>{switch(this.type){case"if":return new a(this,e);case"attr":return new o(this,e);case"class":return new h(this,e);case"for":return new l(this,e);case"html":return new u(this,e);case"rdo":return new f(this,e)}})}}class c{constructor(e,t,s){this.raw=t,this.directive=e,s||(this.reference=this.assignReference(t))}assignReference(e){const t=A.getReference(this,e);return this.directive.element.instance.references.push(t),t}run(e){}}class a extends c{run(e){const t=this.directive.element;e?(t.raw.style.display=null,Array.from(t.raw.children).forEach(e=>t.instance.register(e,this.directive.element.scope))):(t.raw.style.display="none",Array.from(t.raw.children).forEach(e=>t.instance.unregister(e)))}}class o extends c{constructor(e,t){const s=t.split(":");super(e,t,!0),this.attribute=s.shift(),this.reference=this.assignReference(s.join(":"))}run(e){const s=this.directive.element.raw;"value"===this.attribute&&"SELECT"===s.tagName?Array.from(s.getElementsByTagName("option")).forEach(s=>{Array.isArray(e)&&t(s.value).oneOf(e)||e==s.value?s.selected=!0:s.selected=!1}):e?s.setAttribute(this.attribute,e):s.hasAttribute(this.attribute)&&s.removeAttribute(this.attribute)}}class h extends c{constructor(e,t){const s=t.split(":");super(e,t,!0),this.classes=s.shift().split(","),this.reference=this.assignReference(s.join(":"))}run(e){const t=this.directive.element.raw;this.classes.forEach(s=>{e?t.classList.contains(s)||t.classList.add(s):t.classList.contains(s)&&t.classList.remove(s)})}}class l extends c{constructor(e,t){const s=t.split(":");super(e,t,!0),this.alias=s.shift(),this.originalHTML=this.directive.element.raw.innerHTML,this.reference=this.assignReference(s.join(":"))}run(e){const t=e,s=this.directive.element,r=s.raw,i=r.children.length,n=t.length-i;if(Array.from(r.children).forEach(e=>s.instance.unregister(e)),n<0){let e=Math.abs(n);for(;e>0;)r.removeChild(r.lastChild),e-=1}else n>0&&(r.innerHTML+=this.originalHTML.repeat(n));Array.from(r.children).some((e,r)=>{const i=Object.assign({},this.directive.element.scope);i[this.alias]=Object.assign({$collection:t,$index:r},t[r]),s.instance.register(e,i)}),"SELECT"===r.tagName&&s.directives.some(e=>{if("attr"===e.type)return e.expressions.some(e=>{if("value"===e.attribute)return setTimeout(()=>e.run(e.reference.get())),!0}),!0})}}class u extends c{run(e){const t=this.directive.element.instance,s=this.directive.element;Array.from(s.raw.children).forEach(e=>t.unregister(e)),s.raw.innerHTML=e,Array.from(s.raw.children).forEach(e=>t.register(e,this.directive.element.scope))}}class f extends c{run(e){const t=this.directive.element.raw.getAttribute("name"),s=Array.from(document.getElementsByName(t));s.forEach(t=>{t.value===e?t.checked=!0:t.checked=!1})}static isFirstRdoOfGroup(e,t){let s=!0;return e.elements.some(({raw:e})=>{"INPUT"===e.tagName&&"radio"===e.getAttribute("type")&&e.getAttribute("name")===t.getAttribute("name")&&(s=!1)}),s}}class d{constructor(e,t){let s=t.split(":");this.directive=e,this.events=s.shift().split(","),this.raw=t,s=s.join(":").split(","),this.actions=s.map(e=>"$update"===e?this.getUpdater():-1!==e.indexOf("=")?new g(this,e):new m(this,e)),this.elo=(e=>this.actions.forEach(t=>t.run(e))),this.events.forEach(e=>this.directive.element.raw.addEventListener(e,this.elo))}destroy(){this.events.forEach(e=>{this.directive.element.raw.removeEventListener(e,this.elo)})}getUpdater(){const e=this.directive.element,s=e.directives.map(e=>e.type);return t("attr").oneOf(s)?"INPUT"===e.raw.tagName&&t(e.raw.getAttribute("type")).oneOf(["checkbox","radio"])?new y(this):new v(this):t("html").oneOf(s)&&e.raw.isContentEditable?new w(this):t("rdo").oneOf(s)?new x(this):void 0}}class p{constructor(e,t){this.listener=e,t&&(this.raw=t)}run(e){}}class m extends p{constructor(e,t){super(e,t),this.callee=A.getReference(this,t)}run(e){this.callee.get({event:e})}}class g extends p{constructor(e,t){const s=t.split("=");super(e,t),this.left=A.getReference(this,s.shift()),this.right=A.getReference(this,s[0])}run(){const e=this.right.get();this.left.obj[this.left.key]=e}}class b extends p{}class v extends b{constructor(e){super(e),this.listener.directive.element.directives.some(e=>{"attr"===e.type&&e.expressions.some(e=>{"value"===e.attribute&&e.reference instanceof O&&(this.updatee=e.reference)})})}run(){const e=this.listener.directive.element.raw;this.updatee.obj[this.updatee.key]=e.value}}class y extends b{constructor(e){super(e),this.listener.directive.element.directives.some(e=>{"attr"===e.type&&e.expressions.some(e=>{"checked"===e.attribute&&e.reference instanceof O&&(this.updatee=e.reference)})})}run(){const e=this.listener.directive.element.raw;this.updatee.obj[this.updatee.key]=e.checked}}class w extends b{constructor(e){super(e),this.listener.directive.element.directives.some(e=>{"html"===e.type&&e.expressions[0].reference instanceof O&&(this.updatee=e.expressions[0].reference)})}run(){const e=this.listener.directive.element.raw;this.updatee.obj[this.updatee.key]=e.innerHTML}}class x extends b{constructor(e){super(e),this.listener.directive.element.directives.some(e=>{"rdo"===e.type&&e.expressions[0].reference instanceof O&&(this.updatee=e.expressions[0].reference)})}run(){const e=this.listener.directive.element.raw.getAttribute("name"),t=Array.from(document.getElementsByName(e));let s;t.some(e=>{if(e.checked)return s=e.value,!0}),this.updatee.obj[this.updatee.key]=s}}class A{constructor(e,t){this.parent=e,this.raw=t}get(e){}run(){let e=this.get(),t=e;"object"==typeof t&&(t=JSON.stringify(t)),t!==this.value&&(this.value=t,A.bubbleUp(this).run(e))}static bubbleUp(e){let t=e;for(;t instanceof A;)t=t.parent;return t}static getReference(e,t){let s;return s=/[=<!>]/.test(t.substring(1))?new E(e,t):new O(e,t),s}}class E extends A{constructor(e,t){const s=t.match(/([=<!>]{1,3})/)[0],r=t.indexOf(s);super(e,t),this.comparator=s,this.left=A.getReference(this,t.substring(0,r)),this.right=A.getReference(this,t.substring(r+s.length)),e instanceof c&&this.run()}get(e){const t=this.left.get(e),s=this.right.get(e);switch(this.comparator){case"==":return t==s;case"===":return t===s;case"!=":case"!==":return t!=s;case"<":return t<s;case">":return t>s;case"<=":return t<=s;case">=":return t>=s}}}class O extends A{constructor(e,t){const s=t.split(":");super(e,t),this.base=s.shift(),this.obj={value:t},this.key="value",this.base.startsWith("!")&&(this.bang=!0,this.base=this.base.substring(1)),this.args=s.map(e=>A.getReference(this,e));let r=A.bubbleUp(this.parent);r=r instanceof p?r.listener.directive:r.directive,this.scope=r.element.scope,this.scope.element=r.element.raw,r instanceof o?this.scope.attributeName=r.attribute:r instanceof h?this.scope.classNames=r.classes:r instanceof l?this.scope.itemName=r.alias:r instanceof d&&(this.scope.eventNames=r.events);let i=this.maybeGetObjAndKey(this.base,this.scope);i.nah&&(i=this.maybeGetObjAndKey(this.base)),i.nah||(this.obj=i.obj,this.key=i.key),e instanceof c&&this.run()}get(e){let t=A.bubbleUp(this.parent),s=this.obj[this.key];t=t instanceof c?t.directive:t.listener.directive;let r=this.scope;if(e&&(r=Object.assign({},r,e)),"function"==typeof s){const t=this.args.map(t=>t.get(e));s=s.apply(r,t)}return this.bang?!s:s}maybeGetObjAndKey(e,t){const s={nah:!0},r=-1!==e.indexOf("[");let i,n=-1!==e.indexOf(".");if(t)i=t;else{let e=A.bubbleUp(this.parent);e=e instanceof c?e.directive.element.instance.root:e.listener.directive.element.instance.root,i=e}if(/[^a-z0-9.[\]$_]/i.test(e))return s;if(!r&&!n)return i.hasOwnProperty(e)?{obj:i,key:e}:s;if(r){let r=!0;for(;/\[[^\[\]]*\]/.test(e);)e=e.replace(/\[([^\[\]]*)\]/g,(e,s)=>{const i=this.maybeGetObjAndKey(s,t);return i.key?"."+i.obj[i.key]:(r=!1,"")});if(!r)return s;n||(n=!0)}if(n){const t=e.split(".");let r;return t.some((e,s)=>{if(s===t.length-1)r=e;else{if("object"!=typeof i||!i.hasOwnProperty(e))return r=!1,!0;i=i[e]}}),"string"==typeof r?{obj:i,key:r}:s}}}e.register=((e,t)=>new r(e,t))})(simpleDirectives);