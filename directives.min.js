const simpleDirectives={};(function(e){function t(e){return{in:t=>-1!==t.indexOf(e),oneOf:t=>t.some(t=>t===e)}}function s(e){let t;for(;-1!==(t=e.indexOf(null));)e.splice(t,1)}function i(e){const t=e.split(":"),s=t.shift(),i=t.join(":");return[s,i]}class r{constructor(e,t){this.elements=[],this.pointers=[],this.root=t||window,this.register(e||document.body),this.runner()}register(e,i){const r=["sd-attr","sd-class","sd-for","sd-html","sd-if","sd-on","sd-rdo"];let c,a=!1;if(e.hasAttributes()){let h=Array.from(e.attributes).map(s=>{let i=!0;return"sd-rdo"!==s.name||d.isFirstRdoOfGroup(this,e)||(i=!1),t(s.name).in(r)&&i?(t(s.name).in(["sd-if","sd-for"])&&(a=!0),{type:s.name,value:s.value.replace(/\s+/g,"")}):null});s(h),h.length&&(c=new n(this,e,h,Object.assign({},i||{})),this.elements.push(c))}c&&a||Array.from(e.children).forEach(e=>this.register(e,i))}runner(){this.pointers.forEach(e=>e.run()),setTimeout(()=>this.runner(),200)}unregister(e){let t=this.elements;t=t.map(t=>t.scope.element===e||e.contains(t.scope.element)?t.unregister():t),s(t)}getSimpleElement(e){let t=[];return this.elements.forEach(s=>{if(s.scope.element===e)return t.push(s),!0}),t}}class n{constructor(e,s,i,r){this.directives=[],this.instance=e,this.scope=r,this.scope.element=s,s.setAttribute("sd-registered","true"),i.forEach(e=>{if(t(e.type).in(["sd-attr","sd-class","sd-on"])&&t(";").in(e.value)){const t=e.value.split(";");t.forEach(t=>this.directives.push(c.getDirective(this,e.type,t)))}else this.directives.push(c.getDirective(this,e.type,e.value))})}unregister(){return this.scope.element.removeAttribute("sd-registered"),this.directives.forEach(e=>{e instanceof f&&e.destroy(),e instanceof o&&(this.scope.element.innerHTML=e.originalHTML)}),this.instance.pointers=this.instance.pointers.map(e=>{const t=j.bubbleUp(e);return t.element===this?null:e}),s(this.instance.pointers),null}}class c{constructor(e,t){this.element=e,this.expression=t,this.scope=e.scope}static getDirective(e,t,s){switch(t.substring(3)){case"attr":return new a(e,s);case"class":return new h(e,s);case"for":return new o(e,s);case"html":return new l(e,s);case"if":return new u(e,s);case"on":return new f(e,s);case"rdo":return new d(e,s)}}}class a extends c{constructor(e,t){super(e,t);const[s,r]=i(t);this.attribute=s,this.scope.attributeName=this.attribute,this.reference=j.getReference(this,r)}run(e){const s=this.scope.element;"value"===this.attribute&&"SELECT"===s.tagName?Array.from(s.getElementsByTagName("option")).forEach(s=>{Array.isArray(e)&&t(s.value).in(e)||e==s.value?s.selected=!0:s.selected=!1}):e?(s.setAttribute(this.attribute,e),"value"===this.attribute&&(s.value=e)):(s.hasAttribute(this.attribute)&&s.removeAttribute(this.attribute),"value"===this.attribute&&(s.value=""))}}class h extends c{constructor(e,t){super(e,t),this.cachedState=2;const[s,r]=i(t);this.classes=s.split(","),this.scope.classNames=this.classes,this.reference=j.getReference(this,r)}run(e){if(2===this.cachedState)this.cachedState=e?1:0;else if(e&&0===this.cachedState)this.cachedState=1;else{if(e||1!==this.cachedState)return;this.cachedState=0}const t=this.scope.element;this.classes.forEach(s=>{e?t.classList.contains(s)||t.classList.add(s):t.classList.contains(s)&&t.classList.remove(s)})}}class o extends c{constructor(e,t){super(e,t);const[s,r]=i(t);this.alias=s,this.scope.itemName=this.alias,this.originalChildren=this.scope.element.children.length,this.originalHTML=this.scope.element.innerHTML,this.reference=j.getReference(this,r)}run(e){if(!e)return;const{instance:t,directives:s}=this.element,i=this.scope.element,r=document.createElement("div");if(r.innerHTML=this.originalHTML.repeat(e.length),Array.from(i.children).forEach(e=>{t.unregister(e)}),i.children.length>r.children.length)Array.from(Array(i.children.length-r.children.length)).forEach(()=>{i.removeChild(i.lastChild)});else if(i.children.length<r.children.length){const e=Array.from(r.children).slice(i.children.length);e.forEach((e,t)=>{i.appendChild(e)})}Array.from(i.children).forEach((s,i)=>{const r=Math.floor(i/this.originalChildren),n=Object.assign({},this.scope);n[this.alias]=Object.assign({$collection:e,$index:r},e[r]),t.register(s,n)}),"SELECT"===i.tagName&&s.some(e=>{if(e instanceof a&&"value"===e.attribute)return setTimeout(()=>e.run(e.reference.get())),!0})}}class l extends c{constructor(e,t){super(e,t),this.reference=j.getReference(this,t)}run(e){const t=this.element.instance,s=this.scope.element;Array.from(s.children).forEach(e=>t.unregister(e)),s.innerHTML=e,Array.from(s.children).forEach(e=>t.register(e,this.scope))}}class u extends c{constructor(e,t){super(e,t),this.cachedState=2,this.reference=j.getReference(this,t)}run(e){if(2===this.cachedState)this.cachedState=e?1:0;else if(e&&0===this.cachedState)this.cachedState=1;else{if(e||1!==this.cachedState)return;this.cachedState=0}const t=this.element.instance,s=this.scope.element;e?(s.style.display=null,Array.from(s.children).forEach(e=>t.register(e,Object.assign({},this.scope)))):(s.style.display="none",Array.from(s.children).forEach(e=>t.unregister(e)))}}class d extends c{constructor(e,t){super(e,t),this.reference=j.getReference(this,t)}run(e){const t=this.scope.element.getAttribute("name"),s=Array.from(document.getElementsByName(t));s.forEach(t=>{t.value===e?t.checked=!0:t.checked=!1})}static isFirstRdoOfGroup(e,t){let s=!0;return e.elements.some(({scope:e})=>{"INPUT"===e.element.tagName&&"radio"===e.element.getAttribute("type")&&e.element.getAttribute("name")===t.getAttribute("name")&&(s=!1)}),s}}class f extends c{constructor(e,s){super(e,s);const[r,n]=i(s);this.events=r.split(","),this.scope.eventNames=this.events,this.actions=n.split(",").map(e=>"$update"===e?this.getUpdater():t("=").in(e)?new g(this,e):new m(this,e)),this.listener=(e=>this.actions.forEach(t=>t.run(e))),this.events.forEach(e=>this.scope.element.addEventListener(e,this.listener))}destroy(){this.events.forEach(e=>this.scope.element.removeEventListener(e,this.listener))}getUpdater(){const e=this.scope.element;return e.hasAttribute("sd-attr")?"INPUT"===e.tagName&&t(e.getAttribute("type")).in(["checkbox","radio"])?new v(this):new y(this):e.hasAttribute("sd-html")&&e.isContentEditable?new A(this):e.hasAttribute("sd-rdo")?new E(this):void 0}}class p{constructor(e){this.directive=e,this.scope=e.scope}}class m extends p{constructor(e,t){super(e),this.callee=j.getReference(this,t)}run(e){const t=this.callee.obj[this.callee.key],s=this.callee.args.map(e=>e.bang?!e.obj[e.key]:e.obj[e.key]);t.apply(Object.assign({event:e},this.scope),s)}}class g extends p{constructor(e,t){super(e);const s=t.split("=");this.left=j.getReference(this,s[0]),this.right=j.getReference(this,s[1])}run(){const e=this.right.get();this.left.obj[this.left.key]=e}}class b extends p{}class y extends b{constructor(e){super(e),this.directive.element.directives.some(e=>{if(e instanceof a&&"value"===e.attribute&&e.reference instanceof w)return this.updatee=e.reference,!0})}run(){const e=this.scope.element.value;"number"!=typeof this.updatee.obj[this.updatee.key]||isNaN(Number(e))?this.updatee.obj[this.updatee.key]=e:this.updatee.obj[this.updatee.key]=Number(e)}}class v extends b{constructor(e){super(e),this.directive.element.directives.some(e=>{if(e instanceof a&&"checked"===e.attribute&&e.reference instanceof w)return this.updatee=e.reference,!0})}run(){const e=this.scope.element;this.updatee.obj[this.updatee.key]=e.checked}}class A extends b{constructor(e){super(e),this.directive.element.directives.some(e=>{if(e instanceof l&&e.reference instanceof w)return this.updatee=e.reference,!0})}run(){const e=this.scope.element;this.updatee.obj[this.updatee.key]=e.innerHTML}}class E extends b{constructor(e){super(e),this.directive.element.directives.some(e=>{if(e instanceof l&&e.reference instanceof w)return this.updatee=e.reference,!0})}run(){const e=this.scope.element.getAttribute("name"),t=Array.from(document.getElementsByName(e));let s;t.some(e=>{if(e.checked)return s=e.value,!0}),this.updatee.obj[this.updatee.key]=s}}class j{constructor(e){this.parent=e,this.scope=e.scope}static bubbleUp(e){let t=e;for(;t instanceof j;)t=t.parent;return t}static getReference(e,t,s){return/[=<!>]/.test(t.substring(1))?new k(e,t,s):new w(e,t,s)}}class k extends j{constructor(e,t,s){super(e);const i=t.match(/([=<!>]{1,3})/)[0],r=t.indexOf(i);this.comparator=i,this.left=j.getReference(this,t.substring(0,r),s),this.right=j.getReference(this,t.substring(r+i.length),s)}get(){const e=this.left.get(),t=this.right.get();switch(this.comparator){case"==":return e==t;case"===":return e===t;case"!=":case"!==":return e!=t;case"<":return e<t;case">":return e>t;case"<=":return e<=t;case">=":return e>=t}}}class w extends j{constructor(e,t,s){super(e),this.args=[],this.bang=!1,t.startsWith("!")&&(this.bang=!0,t=t.substring(1));const[r,n]=i(t);this.base=r,n&&(this.args=n.split(":").map(e=>j.getReference(this,e,!0))),this.obj={value:t},this.key="value";let a=this.maybeGetObjAndKey(this.base,this.scope);if(a.nah&&(a=this.maybeGetObjAndKey(this.base)),a.nah||(this.obj=a.obj,this.key=a.key),!s){const e=j.bubbleUp(this);e instanceof c&&!(e instanceof f)&&(e.element.instance.pointers.push(this),this.run(!0))}}get(){let e=this.obj[this.key];if("function"==typeof e){const t=this.args.map(e=>e.bang?!e.obj[e.key]:e.obj[e.key]);e=e.apply(this.scope,t)}return this.bang?!e:e}maybeGetObjAndKey(e,s){const i={nah:!0},r=t("[").in(e);let n,a=t(".").in(e);if(s)n=s;else{let e=j.bubbleUp(this);e=e instanceof c?e.element.instance.root:e.directive.element.instance.root,n=e}if(/[^a-z0-9.[\]$_]/i.test(e))return i;if(!r&&!a)return n.hasOwnProperty(e)?{obj:n,key:e}:i;if(r){let t=!0;for(;/\[[^\[\]]*\]/.test(e);)e=e.replace(/\[([^\[\]]*)\]/g,(e,i)=>{const r=this.maybeGetObjAndKey(i,s);return r.key?"."+r.obj[r.key]:(t=!1,"")});if(!t)return i;a||(a=!0)}if(a){const t=e.split(".");let s;return t.some((e,i)=>{if(i===t.length-1)s=e;else{if("object"!=typeof n||!n.hasOwnProperty(e))return s=!1,!0;n=n[e]}}),"string"==typeof s?{obj:n,key:s}:i}}run(e){let t=this.get(),s=!1;if(Array.isArray(t)&&Array.isArray(this.value)?t.length!==this.value.length?s=!0:t.some((e,t)=>{if(e!==this.value[t])return s=!0,!0}):t!==this.value&&(s=!0),Array.isArray(t)&&(t=t.slice(0)),s||e){const e=j.bubbleUp(this);this.value=t;try{e.run(e.reference.get())}catch(t){setTimeout(()=>e.run(e.reference.get()))}}}}e.register=((e,t)=>new r(e,t))})(simpleDirectives);