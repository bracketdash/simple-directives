const simpleDirectives={events:{addListeners:function(e){let t=[];e.references.forEach(function(r){t.push(simpleDirectives.events.getAction(e,r))}),e.listener={handleEvent:function(e){t.forEach(function(e){e()})}},e.preReferences.forEach(function(t){e.element.addEventListener(t,e.listener)})},getAction:function(e,t){let r;if("$update"===t)return simpleDirectives.events.getUpdater(e);if(-1!==t.indexOf("=")){const i=t.split("="),s=simpleDirectives.references.convert(i[0],e),n=simpleDirectives.references.convert(i[1],e);r=n.bang?function(){"function"==typeof n.parent[n.target]?s.parent[s.target]=!n.parent[n.target]():s.parent[s.target]=!n.parent[n.target]}:function(){"function"==typeof n.parent[n.target]?s.parent[s.target]=n.parent[n.target]():s.parent[s.target]=n.parent[n.target]}}else{const i=t.split(":"),s=simpleDirectives.references.convert(i[0],e);t=i.shift(),r=function(){let t=i.map(function(t){let r=simpleDirectives.references.convert(t,e);return r.parent[r.target]});s.parent[s.target].apply(e,t)}}return r},getUpdater:function(e){let t,r,{element:i}=e;if(i.hasAttribute("sd-attr")){let s,n="value";t=i.getAttribute("sd-attr"),"input"===i.tagName&&-1!==["checkbox","radio"].indexOf(i.getAttribute("type"))&&(n="checked"),s=t.indexOf(n),-1!==s&&(t=t.substring(s).split(":")[1],s=t.indexOf(";"),-1!==s&&(t=t.substring(0,s)),t=simpleDirectives.references.convert(t,e),r=function(){t.parent[t.target]=i[n]})}else i.hasAttribute("sd-html")&&i.isContentEditable?(t=simpleDirectives.references.convert(i.getAttribute("sd-html"),e),r=function(){t.parent[t.target]=i.innerHTML}):i.hasAttribute("sd-rdo")&&(t=simpleDirectives.references.convert(i.getAttribute("sd-rdo"),e),r=function(){let e;Array.from(document.getElementsByName(i.getAttribute("name"))).some(function(t){if(t.checked)return e=t.value,!0}),t.parent[t.target]=e});return r}},proxies:{addAction:function(e){const{element:t,references:r,type:i}=e;let s=r[0].split(":"),n=s.shift();simpleDirectives.proxies.cache[n]||simpleDirectives.proxies.createRevocable(n,e);const c=simpleDirectives.tools.createAction(e,s);e.proxyAction=c,simpleDirectives.proxies.cache[n].push(c)},cache:{},createRevocable:function(e,t){const r=simpleDirectives.references.convert(e,t);simpleDirectives.proxies.cache[e]=[],t.proxyRef=Proxy.revocable(r.parent,{set:function(t,r,i){return r===i.target&&simpleDirectives.proxies.cache[e].forEach(function(e){e(i)}),i}}),r.parent=t.proxyRef.proxy},removeAction:function(e){e.references.forEach(function(t){simpleDirectives.proxies.cache[t].map(function(t){return t===e.proxyAction?null:t}),simpleDirectives.tools.removeNulls(simpleDirectives.proxies.cache[t]),simpleDirectives.proxies.cache[t].length||(e.proxyRef.revoke(),delete simpleDirectives.proxies.cache[t])})}},references:{comparison:function(e,t,r){const i=t.split(e);let s,n=simpleDirectives.references.convert(i[0],r),c=simpleDirectives.references.convert(i[1],r);switch(n="function"==typeof n.parent[n.target]?n.parent[n.target].apply(r):n.bang?!n.parent[n.target]:n.parent[n.target],c="function"==typeof c.parent[c.target]?c.parent[c.target].apply(r):c.bang?!c.parent[c.target]:c.parent[c.target],e){case"==":s=n==c;break;case"===":s=n===c;break;case"!=":case"!==":s=n!=c;break;case"<":s=n<c;break;case">":s=n>c;break;case"<=":s=n<=c;break;case">=":s=n>=c}return{parent:{value:s},target:"value"}},convert:function(e,t){const r={parent:{value:e},target:"value"},i=-1!==e.indexOf("[");let s,n,c,a=!1,o=e.split(":");if(e=o.shift(),s=-1!==e.indexOf("."),/[=<!>]/.test(e)){if(0!==e.indexOf("!")||/[=<!>]/.test(e.substring(1))){let i=e.match(/([=<!>]{2,3})/)[0];return-1!==["==","===","!=","!==","<",">","<=",">="].indexOf(i)?simpleDirectives.references.comparison(i,e,t):r}e=e.substring(1),a=!0}if(/[^a-z0-9.[\]$_]/i.test(e))return r;if(n=Object.assign({},simpleDirectives.root,t),i||s){if(i){for(;/\[[^\[\]]*\]/.test(e);)e=e.replace(/\[([^\[\]]*)\]/g,function(e,r){let i=simpleDirectives.references.convert(r,t);return"."+i.parent[i.target]});s||(s=!0)}if(s){let t=e.split(".");t.some(function(r,i){if(i===t.length-1)c=r;else{if("object"!=typeof n||!n.hasOwnProperty(r))return n={value:e},c="value",!0;n=n[r]}})}}else c=e;return{bang:a,parent:n,target:c,refArgs:o}}},registry:{add:function(e,t,r,i,s){const n={attr:"attributeName",class:"className",for:"itemName",on:"eventName"};let c,a={element:e,type:t,references:r},o=!1,l=!0;switch(s&&Object.assign(a,s),i&&(a.preReferences=i,n[t]&&(a[n[t]]=i)),t){case"for":a.originalHTML=e.innerHTML;break;case"if":c=simpleDirectives.references.convert(r[0],s),l=c.bang?!c.parent[c.target]:!!c.parent[c.target];break;case"rdo":simpleDirectives.registry.cache.some(function(t){"rdo"===t.type&&t.element===e&&(o=!0)})}if("on"===t)simpleDirectives.events.addListeners(a);else{const e=r[0],i=simpleDirectives.references.convert(e,a);"for"===t||/[=<!>]/.test(e.substring(1))||-1!==["string","number"].indexOf(typeof i.parent[i.target])?simpleDirectives.watchers.addAction(a):simpleDirectives.proxies.addAction(a)}return o||simpleDirectives.registry.cache.push(a),l},cache:[],register:function(e,t,r){let i,s,n=!1;t||simpleDirectives.registry.unregister(e),["if","attr","class","for","html","on","rdo"].some(function(t){let c;return i=`sd-${t}`,!!e.hasAttribute(i)&&(s=e.getAttribute(i).replace(/\s+/,"").split(";"),-1!==["attr","class","for","on"].indexOf(t)?s.forEach(function(i){const s=i.split(":"),n=s.shift().split(","),c=s.join(":").split(",");r?simpleDirectives.registry.add(e,t,c,n,r):simpleDirectives.registry.add(e,t,c,n)}):c=r?simpleDirectives.registry.add(e,t,[s[0]],[],r):simpleDirectives.registry.add(e,t,[s[0]]),"if"===t?!1===c&&(e.style.display="none",n=!0,!0):void("for"===t&&(n=!0)))}),n||Array.from(e.children).forEach(e=>simpleDirectives.registry.register(e,!0))},unregister:function(e){simpleDirectives.registry.cache=simpleDirectives.registry.cache.map(function(t){let{element:r,type:i}=t;return r===e||e.contains(r)?("on"===i?t.preReferences.forEach(function(e){r.removeEventListener(e,t.listener)}):t.proxyAction?simpleDirectives.proxies.removeAction(t):simpleDirectives.watchers.removeAction(t),null):t}),simpleDirectives.tools.removeNulls(simpleDirectives.registry.cache)}},root:window,tools:{createAction:function(e,t){const{type:r,element:i,preReferences:s}=e;let n;switch(r){case"if":n=function(e){e?(i.style.display=null,simpleDirectives.registry.register(i)):(i.style.display="none",simpleDirectives.registry.unregister(i))};break;case"for":case"html":n=function(e){i.children.length&&Array.from(i.children).forEach(function(e){simpleDirectives.registry.unregister(e)}),i.innerHTML=e,i.children.length&&Array.from(i.children).forEach(function(e){simpleDirectives.registry.unregister(e)})};break;case"attr":n=function(e){if(s.length>1)s.forEach(function(t){void 0===e?i.hasAttribute(t)&&i.removeAttribute(t):i.setAttribute(t,e)});else{const t=s[0];void 0===e?i.hasAttribute(t)&&i.removeAttribute(t):i.setAttribute(t,e)}};break;case"rdo":n=function(e){const t=Array.from(document.getElementsByName(i.getAttribute("name")));t.forEach(function(t){t.value===e?t.checked=!0:t.checked=!1})};break;case"class":n=function(e){if(s.length>1)s.forEach(function(t){e?i.classList.contains(t)||i.classList.add(t):i.classList.contains(t)&&i.classList.remove(t)});else{const t=s[0];e?i.classList.contains(t)||i.classList.add(t):i.classList.contains(t)&&i.classList.remove(t)}}}return function(r){i.parentElement?("function"==typeof r&&(t=t.map(function(t){const r=simpleDirectives.references.convert(t,e);return r.parent[r.target]}),r=r.apply(e,t)),n(r)):simpleDirectives.registry.unregister(i)}},removeNulls:function(e){let t;for(;-1!==(t=e.indexOf(null));)e.splice(t,1)}},watchers:{addAction:function(e){let t=e.references[0].split(":");t.shift();const r=simpleDirectives.tools.createAction(e,t);e.watcherAction=r,simpleDirectives.watchers.cache.push({action:r,directive:e,lastValue:!1}),simpleDirectives.watchers.running||simpleDirectives.watchers.runner()},cache:[],removeAction:function(e){simpleDirectives.watchers.cache=simpleDirectives.watchers.cache.map(function(t){return t.action===e.watcherAction?null:t}),simpleDirectives.tools.removeNulls(simpleDirectives.watchers.cache)},runner:function(){simpleDirectives.watchers.running||(simpleDirectives.watchers.running=!0),simpleDirectives.watchers.cache.forEach(function(e){const{action:t,directive:r,lastValue:i}=e,s=simpleDirectives.references.convert(r.references[0],r);s.parent[s.target]!=i&&(e.lastValue=s.parent[s.target],t(s.parent[s.target]))}),setTimeout(simpleDirectives.watchers.runner,250)},running:!1}};